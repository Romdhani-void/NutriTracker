<div class="page-wrapper max-w-lg mx-auto">

  <!-- ‚îÄ‚îÄ Nav ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <nav class="flex items-center justify-between mb-8 animate-fade-in">
    <a routerLink="/dashboard" class="btn-ghost text-xs px-3 py-2">
      ‚Üê Back to today
    </a>
    <div class="flex items-center gap-2">
      <span class="text-xl select-none">üìÖ</span>
      <span class="font-display font-semibold text-[#3d2a1e]">History</span>
    </div>
  </nav>

  <!-- ‚îÄ‚îÄ Loading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (loading()) {
    <div class="flex flex-col gap-4 animate-fade-in">
      <div class="skeleton h-24 w-full rounded-3xl"></div>
      <div class="skeleton h-16 w-full rounded-3xl"></div>
      <div class="skeleton h-16 w-full rounded-3xl"></div>
      <div class="skeleton h-16 w-full rounded-3xl"></div>
    </div>
  }

  @if (!loading()) {
    <div class="flex flex-col gap-5 stagger">

      <!-- ‚îÄ‚îÄ Stats summary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      @if (logs().length > 0) {
        <div class="grid grid-cols-3 gap-3 animate-fade-in-up">
          <div class="card-sm text-center">
            <div class="font-display text-2xl font-semibold text-[#3d2a1e]">{{ totalDays() }}</div>
            <div class="text-[#7a5c45] text-xs font-body mt-1">Days logged</div>
          </div>
          <div class="card-sm text-center">
            <div class="font-display text-2xl font-semibold text-[#5f8263]">{{ metCount() }}</div>
            <div class="text-[#7a5c45] text-xs font-body mt-1">Goals met</div>
          </div>
          <div class="card-sm text-center">
            <div class="font-display text-2xl font-semibold text-[#b05c3a]">{{ avgCalories() }}</div>
            <div class="text-[#7a5c45] text-xs font-body mt-1">Avg kcal</div>
          </div>
        </div>
      }

      <!-- ‚îÄ‚îÄ Log list ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="card animate-fade-in-up">
        <h2 class="font-display text-lg font-semibold mb-4 text-[#3d2a1e]">
          Past days
          <span class="text-[#b89c85] font-body font-normal text-sm ml-2">(last 60)</span>
        </h2>

        @if (logs().length === 0) {
          <div class="text-center py-12">
            <div class="text-5xl mb-3 select-none">üì≠</div>
            <p class="font-display text-lg text-[#7a5c45]">No history yet</p>
            <p class="text-[#b89c85] text-xs font-body mt-1 italic">
              Start logging food and your history will appear here.
            </p>
            <a routerLink="/dashboard" class="btn-primary inline-flex mt-4">
              Go log something ‚Üí
            </a>
          </div>
        } @else {
          <div class="flex flex-col gap-3">
            @for (log of logs(); track log.date) {
              <div class="p-4 rounded-2xl bg-[#fdfaf5] border border-[#e8cfa8] animate-fade-in">

                <!-- Row top: date + status -->
                <div class="flex items-center justify-between mb-2">
                  <span class="font-display font-semibold text-sm text-[#3d2a1e]">
                    {{ formatDate(log.date) }}
                  </span>
                  <span [class]="getStatusClass(log.goalStatus)">
                    {{ getStatusLabel(log.goalStatus) }}
                  </span>
                </div>

                <!-- Progress bar -->
                <div class="w-full h-2 bg-[#f4e4cc] rounded-full overflow-hidden mb-2">
                  <div
                    class="h-full rounded-full progress-fill"
                    [style.width.%]="getProgressWidth(log)"
                    [style.background-color]="getBarColor(log)"
                  ></div>
                </div>

                <!-- Row bottom: calories -->
                <div class="flex items-center justify-between text-xs font-body text-[#7a5c45]">
                  <span>
                    <strong class="font-display text-[#3d2a1e]">{{ log.totalCalories }}</strong> kcal consumed
                  </span>
                  @if (log.dailyCalorieTarget) {
                    <span>goal: {{ log.dailyCalorieTarget }} kcal</span>
                  }
                </div>

              </div>
            }
          </div>
        }
      </div>

      @if (error()) {
        <p class="text-[#a85f5f] text-xs font-body bg-[#a85f5f]/10 rounded-xl px-4 py-3">
          {{ error() }}
        </p>
      }

    </div>
  }

</div>
